function Canvas(t){t=_.clone(t||{}),this.options=_.defaults(t,this.options),this.el=this.options.el,this.ctx=this.el.getContext("2d"),this.dpr=window.devicePixelRatio||1,this.updateDimensions(),window.addEventListener("resize",this.updateDimensions.bind(this),!1),this.resetTarget(),isTouch?(this.el.addEventListener("touchstart",this.touchMove.bind(this),!1),this.el.addEventListener("touchmove",this.touchMove.bind(this),!1)):(window.addEventListener("mousemove",this.mouseMove.bind(this),!1),window.addEventListener("mouseout",this.resetTarget.bind(this),!1)),this.setupParticles(),this.loop()}function Particle(t){if(t=_.clone(t||{}),this.options=_.defaults(t,this.options),this.position=this.shift=new Vector(this.options.x,this.options.y),this.speed=this.options.speed||.01+.04*Math.random(),this.angle=this.options.angle||0,this.options.color){for(var i=this.options.color.split(","),s=-1;++s<3;)i[s]=Math.round(parseInt(i[s],10)+100*Math.random()-50),i[s]=Math.min(i[s],255),i[s]=Math.max(i[s],0);this.color=i.join(", ")}this.options.size=this.options.size||7,this.size=1+Math.random()*this.options.size,this.targetSize=this.options.targetSize||this.options.size,this.orbit=.5*this.options.radius+.5*this.options.radius*Math.random()}function Vector(t,i){this.x=t||0,this.y=i||0}var _=require("lodash"),PI2=2*Math.PI,isTouch="ontouchstart"in window,isSafari=!!navigator.userAgent.match(/Version\/[\d]+.*Safari/);Canvas.prototype.updateDimensions=function(){this.width=this.el.width=_.result(this.options,"width")*this.dpr,this.height=this.el.height=_.result(this.options,"height")*this.dpr,this.el.style.width=_.result(this.options,"width")+"px",this.el.style.height=_.result(this.options,"height")+"px"},Canvas.prototype.mouseMove=function(t){this.target=new Vector(t.clientX*this.dpr,t.clientY*this.dpr)},Canvas.prototype.resetTarget=function(){this.target=new Vector(this.width/2,this.height/2)},Canvas.prototype.touchMove=function(t){1===t.touches.length&&t.preventDefault(),this.target=new Vector(t.touches[0].pageX*this.dpr,t.touches[0].pageY*this.dpr)},Canvas.prototype.options={count:20,speed:.5,width:400,height:400,size:10,radius:5,background:"29, 22, 52",maxDistance:100},Canvas.prototype.setupParticles=function(){this.particles=[];for(var t=-1,i=PI2/this.options.count;++t<this.options.count;){var s,o,h,e=Math.max(this.width,this.height);h=(t+1)*i,s=Math.cos(h)*e,s+=this.width/2,o=Math.sin(h)*e,o+=this.height/2;var n=new Particle({x:s,y:o,radius:this.options.radius,size:this.options.size,angle:h,color:this.options.color});this.particles.push(n)}},Canvas.prototype.findClosest=function(){for(var t=-1,i=this.particles.length;++t<i;){var s=-1;for(this.particles[t].closest=[];++s<i;){var o=this.particles[s],h=this.particles[t].position.distanceTo(o.position);if(h<this.options.maxDistance){var e=new Vector(o.position.x,o.position.y);e.opacity=1-h/this.options.maxDistance,e.distance=h,this.particles[t].closest.push(e)}}}},Canvas.prototype.loop=function(){isTouch||isSafari?this.ghost():this.ghostGradient(),this.options.maxDistance>0&&this.findClosest(),this.draw(),window.requestAnimationFrame(_.bind(this.loop,this))},Canvas.prototype.clear=function(){this.ctx.clearRect(0,0,this.width,this.height)},Canvas.prototype.ghost=function(){this.ctx.globalCompositeOperation="source-over",this.ctx.rect(0,0,this.width,this.height),"string"==typeof this.options.background?this.ctx.fillStyle="rgb("+this.options.background+")":this.ctx.fillStyle="rgb("+this.options.background[0]+")",this.ctx.fill()},Canvas.prototype.ghostGradient=function(){var t;if("string"==typeof this.options.background)this.ctx.fillStyle="rgb("+this.options.background+")";else{t=this.ctx.createRadialGradient(this.width/2,this.height/2,0,this.width/2,this.height/2,Math.max(this.width,this.height)/2);for(var i=this.options.background.length,s=0;s<i;s++)t.addColorStop((s+1)/i,"rgb("+this.options.background[s]+")");this.ctx.fillStyle=t}this.ctx.globalOpacity=.1,this.ctx.globalCompositeOperation="darken",this.ctx.fillRect(0,0,this.width,this.height)},Canvas.prototype.draw=function(){for(var t=-1,i=this.particles.length;++t<i;){var s=this.particles[t],o=s.color||this.options.color;s.update(this.target,t),this.ctx.globalAlpha=.3,this.ctx.globalCompositeOperation="lighten",this.ctx.fillStyle="rgb("+o+")",this.ctx.beginPath(),this.ctx.arc(s.position.x,s.position.y,s.size,0,PI2,!1),this.ctx.closePath(),this.ctx.fill(),this.options.maxDistance>0&&this.drawLines(s,o)}},Canvas.prototype.drawLines=function(t,i){i=i||this.options.color;var s=-1,o=t.closest.length;for(this.ctx.globalAlpha=.2,this.ctx.globalCompositeOperation="screen",this.ctx.lineCap="round";++s<o;)this.ctx.lineWidth=2*t.size*t.closest[s].opacity,this.ctx.strokeStyle="rgba("+i+", "+t.closest[s].opacity+")",this.ctx.beginPath(),this.ctx.moveTo(t.position.x,t.position.y),this.ctx.lineTo(t.closest[s].x,t.closest[s].y),this.ctx.stroke()},Particle.prototype.update=function(t,i){this.angle+=this.speed,this.shift.x+=(t.x-this.shift.x)*this.speed,this.shift.y+=(t.y-this.shift.y)*this.speed,this.position.x=this.shift.x+Math.cos(i+this.angle)*this.orbit,this.position.y=this.shift.y+Math.sin(i+this.angle)*this.orbit,isSafari||(this.size+=.03*(this.targetSize-this.size),Math.round(this.size)===Math.round(this.targetSize)&&(this.targetSize=1+Math.random()*this.options.size))},Vector.prototype.distanceTo=function(t,i){var s=Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2));return i?Math.abs(s):s},module.exports=Canvas;